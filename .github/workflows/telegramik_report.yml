name: Telegram Report
on:
  # Nastaví spouštění každý den ve 22:00 UTC (11 PM CET/CEST)
  schedule:
    - cron: '0 22 * * *'
  # Umožní ruční spuštění z GitHub Actions záložky
  workflow_dispatch:

jobs:
  send_report:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout kód
        uses: actions/checkout@v4

      - name: Nastavení Pythonu
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Použij verzi, jakou potřebuješ

      - name: Instalace závislostí
        run: pip install -r requirements.txt

      - name: Spuštění reportovacího skriptu
        # Zde odkazujeme na skript z bodu 2 (report_generator.py)
        run: python report_generator.py
        
        # Přenášíme tajné klíče jako proměnné prostředí do skriptu
       env:
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
  # Nově přidáno: GITHUB_TOKEN pro čtení CSV souborů
      GITHUB_TOKEN_REPORT: ${{ secrets.GITHUB_TOKEN }}
